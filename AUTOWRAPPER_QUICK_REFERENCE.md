# AutoWrapper Quick Reference

## ? Implementation Checklist

- [x] AutoWrapper.Core package installed (v4.5.1)
- [x] Configuration class created (`AutoWrapperExtensions.cs`)
- [x] Middleware registered in Program.cs
- [x] Middleware placed after authorization and before MapControllers
- [x] Custom exception handler disabled (AutoWrapper handles exceptions)
- [x] Build successful

## ?? Files Created/Modified

### Created:
1. `Wefaaq.Api\Extensions\AutoWrapperExtensions.cs` - Configuration class
2. `AUTOWRAPPER_IMPLEMENTATION.md` - Detailed implementation guide
3. `AUTOWRAPPER_EXAMPLES.md` - Response examples
4. `AUTOWRAPPER_QUICK_REFERENCE.md` - This file

### Modified:
1. `Wefaaq.Api\Program.cs` - Added AutoWrapper middleware
2. `Wefaaq.Api\Wefaaq.Api.csproj` - Added package reference

## ?? Usage in Controllers

Controllers don't need any changes! Just use standard ASP.NET Core methods:

```csharp
// Success responses
return Ok(data);                    // ? Wrapped as 200
return CreatedAtAction(...);        // ? Wrapped as 201
return NoContent();                 // ? Wrapped as 204

// Error responses
return NotFound(new { message }); // ? Wrapped as 404
return BadRequest(ModelState);     // ? Wrapped as 400
```

## ?? Response Structure

All responses follow this format:

```json
{
  "version": "1.0",
  "statusCode": <status-code>,
  "message": "<auto-generated-message>",
  "isError": <true|false>,
  "result": <your-data>  // Only for success responses
}
```

## ?? Configuration Location

To change AutoWrapper settings, edit:
- **File**: `Wefaaq.Api\Extensions\AutoWrapperExtensions.cs`
- **Method**: `UseAutoWrapperConfig()`
- **Options**: Modify the `AutoWrapperOptions` object

## ?? Common Configurations

### Change API Version
```csharp
// In Program.cs
app.UseAutoWrapperConfig(apiVersion: "2.0");
```

### Disable API Version Display
```csharp
// In AutoWrapperExtensions.cs
ShowApiVersion = false,
```

### Disable Response Logging
```csharp
// In AutoWrapperExtensions.cs
EnableResponseLogging = false,
EnableExceptionLogging = false,
```

### Change Wrap Path
```csharp
// In AutoWrapperExtensions.cs
WrapWhenApiPathStartsWith = "/api/v1"
```

## ?? Testing

### Start the API:
```bash
cd Wefaaq.Api
dotnet run
```

### Test Endpoints:
1. **GET**: `https://localhost:5001/api/clients/get-all`
2. **POST**: `https://localhost:5001/api/clients`
3. **PUT**: `https://localhost:5001/api/clients/{id}`
4. **DELETE**: `https://localhost:5001/api/clients/{id}`

### Expected Response:
All responses will be wrapped with version, statusCode, message, and isError.

## ?? Important Notes

1. **Exception Handling**: Custom exception middleware is disabled. AutoWrapper handles all exceptions.
2. **JSON Serialization**: AutoWrapper uses Newtonsoft.Json internally.
3. **Reference Loops**: Configured to ignore circular references.
4. **Swagger**: Works seamlessly - no changes needed.
5. **API-Only**: Only wraps routes starting with "/api".

## ?? Troubleshooting

| Issue | Solution |
|-------|----------|
| Responses not wrapped | Check AutoWrapper is before MapControllers() |
| Swagger not working | Ensure API-only mode is enabled |
| Double wrapping | Disable custom exception middleware |
| Serialization errors | Check for circular references in DTOs |

## ?? Key Features Enabled

? API version in response (v1.0)  
? Status code in response body  
? IsError flag for all responses  
? Response logging enabled  
? Exception logging enabled  
? Request data logging on exceptions  
? Reference loop handling (Ignore)  
? HTML validation bypass  
? API-only mode (routes starting with /api)  

## ?? Resources

- [AutoWrapper GitHub](https://github.com/proudmonkey/AutoWrapper)
- [AutoWrapper Wiki](https://github.com/proudmonkey/AutoWrapper/wiki)
- Full Implementation Guide: `AUTOWRAPPER_IMPLEMENTATION.md`
- Response Examples: `AUTOWRAPPER_EXAMPLES.md`

## ?? Next Steps

1. ? Test all API endpoints
2. ? Update frontend/client code to handle wrapped responses
3. ? Update API documentation
4. ? Consider custom error messages for specific exceptions
5. ? Monitor logs for any issues

## ?? Support

For issues or questions:
1. Check the implementation guide
2. Review the examples
3. Consult the AutoWrapper documentation
4. Check application logs for errors

---

**Status**: ? Fully Implemented and Working  
**Build Status**: ? Successful  
**Version**: 1.0  
**Last Updated**: $(Get-Date)
